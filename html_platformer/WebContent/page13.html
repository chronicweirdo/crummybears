<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Analyze image data: read background objects numbers</title>
<style>
	td, th {
		border: 1px solid black;
		vertical-align: top;
	}
	label {
		float: left;
		clear: left;
	}
	input {
		float: left;
	}
</style>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="jquery.hotkeys-0.7.9.min.js"></script>
<script>
	//constants

	$(function() {
		// import image
		var img = new Image();
		img.onload = function(){
			canvas().drawImage(this,0,0);
			var width = img.naturalWidth;
			var height = img.naturalHeight;
			var imgData = canvas().getImageData(0, 0, width, height);
			//for (i = 0; i < imgData.data.length; i++)
				//log(imgData.data[i]);
			log(imgData.data.length);
			// print row x
			//var x = 100;
			var string = "";
			var zeros = 0;
			var others = 0;
			//var x = 7;
			//var y = 7;
			var corners = new Array();
			for (y = 1; y < height-1; y++) {
				for (x = 1; x < width-1; x++) {
					var data = canvas().getImageData(x-1, y-1, 3, 3).data;
					if (checkCorner(data)) {
						log("new corner");
						corners[corners.length] = {x: x, y: y};
					}
				}
			}
			//}
			//log(string);
			//log(zeros + " " + others);
			for (i = 0; i < corners.lenght; i++) {
				logVector("corner" + i, corners[i]);
			}
		};
		//img.src = 'home_outline.png';
		img.src = 'rect3523.png';
		
	});
	
	function checkCorner(data) {
		var tl, tr, bl, br;
		/* log(data.length);
		log("data:");
		for (i = 0; i < data.length; i+=4) {
			log(data[i] + " " + data[i+1] + " " + data[i+2] + " " + data[i+3]);
		} */
		tl = {r: data[0*4+0], g: data[0*4+1], b: data[0*4+2], a: data[0*4+3]};
		tr = {r: data[2*4+0], g: data[2*4+1], b: data[2*4+2], a: data[2*4+3]};
		bl = {r: data[6*4+0], g: data[6*4+1], b: data[6*4+2], a: data[6*4+3]};
		br = {r: data[8*4+0], g: data[8*4+1], b: data[8*4+2], a: data[8*4+3]};
		//logColor("tl", tl);
		//logColor("tr", tr);
		//logColor("bl", bl);
		//logColor("br", br);
		var tlb, trb, blb, brb;
		tlb = isBlack(tl);
		trb = isBlack(tr);
		blb = isBlack(bl);
		brb = isBlack(br);
		var totalPercent = (tlb + trb + blb + brb) / 4.0;
		var topPercent = (tlb + trb) / 2.0;
		var bottomPercent = (blb + brb) / 2.0;
		var leftPercent = (tlb + blb) / 2.0;
		var rightPercent = (trb + brb) / 2.0;
		//log(totalPercent + " " + topPercent + " " + bottomPercent + " " + leftPercent +  " " + rightPercent);
		if (totalPercent == 0.75 || totalPercent == 0.25) {
			return true;
		}
		return false;
	}
	
	function isBlack(c) {
		if (c.r == 0 && c.g == 0 && c.b == 0) return 1;
		else return 0;
	}

	function random(max) {
		return Math.floor(Math.random()*max);
	}
	
	function canvas() {
		return $('#myCanvas').get(0).getContext('2d');
	}
	function canvasWidth() {
		return $('#myCanvas').first().width();
	}
	function canvasHeight() {
		return $('#myCanvas').first().height();
	}
	
	function log(text) {
		$('#console').prepend(text + '<br />');
	}
	
	function logColor(name, c) {
		log(name + " = (" + c.r + "," + c.g + "," + c.b + "," + c.a + ")");
	}
	function clearLog() {
		$('#console').empty();
	}
	
	function logVector(name, v) {
		log(name + " = (" + v.x + "," + v.y + ")");
	}
	
</script>
</head>
<body>
	<canvas id="myCanvas" width="1000" height="400" style="border:1px solid #000000;"></canvas>
	<div>
		<table style="width: 100%">
			<tr>
				<th>Game settings</th>
				<th>Console</th>
			</tr>
			<tr>
				<td>
					<button onclick="javascript:game.start()">start</button>
					<button onclick="javascript:game.stop()">stop</button>
				</td>
				<td>
					<button onclick="javascript:clearLog()">clear console</button>
					
				</td>
			</tr>
			<tr>
				<td>
					Use keys:
					<ul>
						<li>"left"</li>
						<li>"right"</li>
						<li>"space" - jump, multiple jumps</li>
						<li>"down" - collapse through red platforms</li>
					</ul>
				</td>
				<td>
					<div id="console" style="height: 200px; width: 600px; overflow: scroll;"></div>
				</td>
			</tr>
			
		</table>
	</div>
</body>
</html>